<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ساخت qrcode</title>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --md-sys-color-primary: #89b4fa; 
            --md-sys-color-on-primary: #003062; 
            --md-sys-color-primary-container: #00468a; 
            --md-sys-color-on-primary-container: #d6e3ff; 
            --md-sys-color-background: #1a1c1e; 
            --md-sys-color-on-background: #e3e2e6; 
            --md-sys-color-surface: #1a1c1e; 
            --md-sys-color-on-surface: #e3e2e6; 
            --md-sys-color-surface-variant: #44474f; 
            --md-sys-color-on-surface-variant: #c4c6d0; 
            --md-sys-color-outline: #5a5d64; 
            --md-sys-color-surface-container: #202225; 
            --md-sys-color-surface-container-high: #292a2d; 
            --md-sys-color-surface-container-higher: #333538; 
            --md-sys-color-error: #ffb4ab; 
            --md-sys-color-error-container: #93000a; 
            --md-sys-color-on-error-container: #ffdad6; 
            --md-sys-color-success: #81d89a; 
            --md-sys-color-success-container: #005327; 
            --md-sys-color-on-success-container: #9cf5b4; 
            --font-family: 'Vazirmatn', sans-serif; 
            --border-radius-xl: 28px; 
            --border-radius-large: 16px; 
            --border-radius-medium: 12px; 
            --border-radius-small: 8px; 
        }
        
        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
        }
        
        html { 
            -webkit-tap-highlight-color: transparent; 
            font-size: 15px; 
        }
        
        body { 
            font-family: var(--font-family); 
            background-color: var(--md-sys-color-background); 
            color: var(--md-sys-color-on-background); 
            line-height: 1.7; 
            padding-bottom: 80px; 
        }
        
        a { 
            color: var(--md-sys-color-primary); 
            text-decoration: none; 
        }
        
        .page-header { 
            background-color: rgba(26, 28, 30, 0.85); 
            backdrop-filter: blur(10px); 
            border-bottom: 1px solid var(--md-sys-color-outline); 
            padding: 1rem 1.5rem; 
            position: sticky; 
            top: 0; 
            z-index: 100; 
        }
        
        .nav-container { 
            max-width: 900px; 
            margin: 0 auto; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        
        .logo a { 
            font-size: 1.3rem; 
            font-weight: 700; 
            color: var(--md-sys-color-primary); 
        }
        
        .nav-actions { 
            display: flex; 
            align-items: center; 
            gap: 0.75rem; 
        }
        
        .btn { 
            font-family: inherit; 
            font-size: 0.9rem; 
            padding: 0.6rem 1.2rem; 
            border-radius: var(--border-radius-xl); 
            border: none; 
            cursor: pointer; 
            transition: all 0.2s; 
            text-align: center; 
            display: inline-block; 
            font-weight: 700; 
        }
        
        .btn-primary { 
            background-color: var(--md-sys-color-primary); 
            color: var(--md-sys-color-on-primary); 
        } 
        
        .btn-secondary { 
            background-color: var(--md-sys-color-primary-container); 
            color: var(--md-sys-color-on-primary-container); 
        } 
        
        .btn-danger { 
            background-color: var(--md-sys-color-error-container); 
            color: var(--md-sys-color-on-error-container); 
        }
        
        .page-container { 
            width: 100%; 
            max-width: 820px; 
            margin: 0 auto; 
            padding: 2rem 1.5rem; 
        }
        
        .post-card, .single-post-container { 
            display: flex; 
            flex-direction: column; 
            gap: 1.25rem; 
            background-color: var(--md-sys-color-surface-container); 
            border: 1px solid var(--md-sys-color-outline); 
            border-radius: var(--border-radius-large); 
            padding: 1.5rem; 
        }
        
        .post-content { 
            font-size: 1.05rem; 
            color: var(--md-sys-color-on-surface); 
            word-wrap: break-word; 
            line-height: 1.8; 
        }
        
        .post-content strong { 
            color: var(--md-sys-color-primary); 
            font-weight: 700; 
        }
        
        .code-block-wrapper { 
            background-color: var(--md-sys-color-surface-container-high); 
            border: 1px solid var(--md-sys-color-outline); 
            border-radius: var(--border-radius-medium); 
            margin: 1.5rem 0; 
            overflow: hidden; 
        }
        
        .code-block-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            background-color: var(--md-sys-color-surface-container-higher); 
            padding: 0.5rem 1rem; 
            border-bottom: 1px solid var(--md-sys-color-outline); 
        }
        
        .code-block-title { 
            font-size: 0.8rem; 
            color: var(--md-sys-color-on-surface-variant); 
            font-weight: 700; 
        }
        
        .copy-code-btn { 
            background: transparent; 
            color: var(--md-sys-color-on-surface-variant); 
            border: none; 
            border-radius: var(--border-radius-small); 
            padding: 0.3rem 0.6rem; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            gap: 0.4rem; 
            font-size: 0.8rem; 
        }
        
        .copy-code-btn:hover { 
            background-color: var(--md-sys-color-primary-container); 
            color: var(--md-sys-color-on-primary-container); 
        } 
        
        .copy-code-btn.copied { 
            color: var(--md-sys-color-success); 
        }
        
        pre { 
            white-space: pre-wrap; 
            word-break: break-all; 
            font-family: monospace; 
            direction: ltr; 
            text-align: left; 
            padding: 1rem; 
            font-size: 0.85rem; 
            margin: 0; 
        }
        
        .post-media { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 0.75rem; 
        }
        
        .media-item { 
            border-radius: var(--border-radius-medium); 
            overflow: hidden; 
            border: 1px solid var(--md-sys-color-outline); 
            background-color: var(--md-sys-color-surface-container-high); 
            aspect-ratio: 1 / 1; 
        }
        
        .media-item img, .media-item video { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
            display: block; 
            cursor: pointer; 
            transition: transform 0.3s ease; 
        }
        
        .media-item:hover img, .media-item:hover video { 
            transform: scale(1.05); 
        }
        
        .post-meta { 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: space-between; 
            align-items: center; 
            padding-top: 1rem; 
            margin-top: 1.25rem; 
            border-top: 1px solid var(--md-sys-color-surface-variant); 
            font-size: 0.85rem; 
            color: var(--md-sys-color-on-surface-variant); 
            gap: 1rem; 
        }
        
        .meta-info { 
            display: flex; 
            align-items: center; 
            gap: 0.75rem; 
        }
        
        .author-name { 
            font-weight: bold; 
            color: var(--md-sys-color-on-surface); 
        }
        
        .author-name-btn { 
            background: none; 
            border: none; 
            font-family: inherit; 
            font-size: inherit; 
            color: inherit; 
            cursor: pointer; 
            padding: 0; 
            font-weight: 700; 
        } 
        
        .author-name-btn:hover { 
            text-decoration: underline; 
            color: var(--md-sys-color-primary); 
        }
        
        .like-btn { 
            background-color: var(--md-sys-color-surface-container-high); 
            border: 1px solid var(--md-sys-color-outline); 
            padding: 0.5rem 1rem; 
            border-radius: var(--border-radius-large); 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            gap: 0.5rem; 
            transition: all 0.2s; 
            color: var(--md-sys-color-on-surface-variant); 
        }
        
        .like-btn.liked { 
            background-color: var(--md-sys-color-primary-container); 
            color: var(--md-sys-color-on-primary-container); 
            border-color: var(--md-sys-color-primary); 
        }
        
        .lightbox { 
            display: none; 
            position: fixed; 
            z-index: 1000; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.9); 
            justify-content: center; 
            align-items: center; 
        }
        
        .lightbox.active { 
            display: flex; 
        } 
        
        .lightbox-content { 
            max-width: 90vw; 
            max-height: 90vh; 
            object-fit: contain; 
        }
        
        .post-list-container { 
            display: flex; 
            flex-direction: column; 
            gap: 1.5rem; 
        }
        
        .post-card-link { 
            display: block; 
            text-decoration: none; 
            transition: transform 0.2s, box-shadow 0.2s; 
            border-radius: var(--border-radius-large); 
        }
        
        .post-card-link:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 8px 25px rgba(0,0,0,0.3); 
        }
        
        .post-card-content { 
            display: -webkit-box; 
            -webkit-line-clamp: 4; 
            -webkit-box-orient: vertical; 
            overflow: hidden; 
            color: var(--md-sys-color-on-surface-variant); 
            margin-bottom: 1rem; 
            line-height: 1.8; 
        }
        
        .post-card-footer { 
            font-size: 0.8rem; 
            color: var(--md-sys-color-on-surface-variant); 
            opacity: 0.7; 
        }
        
        .code-snippet-indicator { 
            background-color: var(--md-sys-color-primary-container); 
            color: var(--md-sys-color-on-primary-container); 
            padding: 0.1em 0.5em; 
            border-radius: var(--border-radius-small); 
            font-size: 0.8em; 
        }
        
        .comments-section { 
            border-top: 1px solid var(--md-sys-color-outline); 
            padding-top: 1.5rem; 
            margin-top: 1.5rem; 
        }
        
        .comment { 
            background-color: var(--md-sys-color-surface-container); 
            padding: 1rem; 
            border-radius: var(--border-radius-medium); 
            margin-bottom: 1rem; 
            border: 1px solid var(--md-sys-color-outline); 
        }
        
        .comment-header { 
            display: flex; 
            justify-content: space-between; 
            font-size: 0.8rem; 
            color: var(--md-sys-color-on-surface-variant); 
            margin-bottom: 0.5rem; 
        }
        
        .comment-author { 
            font-weight: 700; 
            color: var(--md-sys-color-primary); 
        }
        
        .comment-body { 
            color: var(--md-sys-color-on-surface); 
            white-space: pre-wrap; 
            word-wrap: break-word; 
        }
        
        .comment-footer { 
            display: flex; 
            justify-content: flex-end; 
            align-items: center; 
            margin-top: 0.75rem; 
        }
        
        .comment-form textarea { 
            width: 100%; 
            min-height: 100px; 
            background-color: var(--md-sys-color-surface-container-high); 
            color: var(--md-sys-color-on-surface); 
            border: 1px solid var(--md-sys-color-outline); 
            border-radius: var(--border-radius-medium); 
            padding: 0.75rem 1rem; 
            font-family: inherit; 
            font-size: 1rem; 
            resize: vertical; 
            margin-bottom: 0.75rem; 
        }
        
        .comment-form textarea:focus { 
            outline: none; 
            border-color: var(--md-sys-color-primary); 
        }
        
        .author-controls { 
            display: flex; 
            align-items: center; 
            gap: 1rem; 
            padding-bottom: 1.5rem; 
            border-bottom: 1px solid var(--md-sys-color-surface-variant); 
            margin-bottom: 1.5rem; 
        }
        
        .bottom-nav { 
            position: fixed; 
            bottom: 0; 
            left: 0; 
            right: 0; 
            height: 70px; 
            background-color: var(--md-sys-color-surface-container); 
            border-top: 1px solid var(--md-sys-color-outline); 
            display: flex; 
            justify-content: space-around; 
            align-items: center; 
            z-index: 200; 
        }
        
        .nav-item { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 4px; 
            color: var(--md-sys-color-on-surface-variant); 
            text-decoration: none; 
            border: none; 
            background: none; 
            font-family: inherit; 
            cursor: pointer; 
        }
        
        .nav-item.active, .nav-item:hover { 
            color: var(--md-sys-color-primary); 
        } 
        
        .nav-item svg { 
            width: 24px; 
            height: 24px; 
            fill: currentColor; 
        } 
        
        .nav-item span { 
            font-size: 0.75rem; 
        }
        
        .fab { 
            position: fixed; 
            bottom: 85px; 
            right: 2rem; 
            width: 56px; 
            height: 56px; 
            background-color: var(--md-sys-color-primary-container); 
            color: var(--md-sys-color-on-primary-container); 
            border-radius: var(--border-radius-large); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.4); 
            transition: all 0.3s ease; 
            text-decoration: none; 
            z-index: 150; 
        }
        
        .fab:hover { 
            background-color: var(--md-sys-color-primary); 
            color: var(--md-sys-color-on-primary); 
            transform: scale(1.1) rotate(90deg); 
        }
        
        .status-card, .error-card { 
            text-align: center; 
            padding: 1.5rem; 
            border-radius: var(--border-radius-large); 
            margin-bottom: 1.5rem; 
        }
        
        .status-card { 
            background-color: var(--md-sys-color-success-container); 
            color: var(--md-sys-color-on-success-container); 
        }
        
        .error-card { 
            background-color: var(--md-sys-color-error-container); 
            color: var(--md-sys-color-on-error-container); 
        }
        
        .dialog-overlay { 
            position: fixed; 
            inset: 0; 
            background: rgba(0,0,0,0.7); 
            z-index: 500; 
            display: none; 
            justify-content: center; 
            align-items: center; 
            padding: 1rem; 
        }
        
        .dialog-overlay.active { 
            display: flex; 
        }
        
        .dialog-content { 
            background-color: var(--md-sys-color-surface-container-high); 
            border-radius: var(--border-radius-xl); 
            padding: 2rem; 
            width: 100%; 
            max-width: 500px; 
            max-height: 90vh; 
            overflow-y: auto; 
            animation: slideUp 0.3s ease; 
        }
        
        @keyframes slideUp { 
            from { 
                transform: translateY(30px); 
                opacity: 0; 
            } to { 
                transform: translateY(0); 
                opacity: 1; 
            } 
        }
        
        .profile-header { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            text-align: center; 
            gap: 1rem; 
            margin-bottom: 1.5rem; 
        }
        
        .profile-pic { 
            width: 100px; 
            height: 100px; 
            border-radius: 50%; 
            object-fit: cover; 
            border: 3px solid var(--md-sys-color-primary); 
        }
        
        .avatar-placeholder { 
            width: 100px; 
            height: 100px; 
            border-radius: 50%; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            font-size: 2.5rem; 
            font-weight: bold; 
            color: white; 
            border: 3px solid var(--md-sys-color-primary); 
        }
        
        .profile-name { 
            font-size: 1.5rem; 
            font-weight: 700; 
        } 
        
        .profile-username { 
            font-size: 0.9rem; 
            color: var(--md-sys-color-on-surface-variant); 
            margin-top: -1rem; 
        }
        
        .profile-stats { 
            display: flex; 
            justify-content: space-around; 
            width: 100%; 
            margin-bottom: 1.5rem; 
            background: var(--md-sys-color-surface-container); 
            padding: 1rem 0; 
            border-radius: var(--border-radius-medium); 
        }
        
        .stat-item { 
            text-align: center; 
        } 
        
        .stat-item-value { 
            font-size: 1.2rem; 
            font-weight: bold; 
        } 
        
        .stat-item-label { 
            font-size: 0.8rem; 
            color: var(--md-sys-color-on-surface-variant); 
        }
        
        .profile-bio { 
            margin-bottom: 1.5rem; 
            text-align: center; 
        }
        
        .profile-actions { 
            display: flex; 
            flex-direction: column; 
            gap: 0.75rem; 
        }
        
        .follow-btn { 
            transition: all 0.2s ease !important; 
        } 
        
        .follow-btn.following { 
            background-color: var(--md-sys-color-surface-variant) !important; 
            color: var(--md-sys-color-on-surface-variant) !important; 
        }
        
        .qr-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
            padding: 2rem;
        }
        
        .qr-input-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .qr-input {
            width: 100%;
            padding: 1rem;
            background-color: var(--md-sys-color-surface-container-high);
            color: var(--md-sys-color-on-surface);
            border: 1px solid var(--md-sys-color-outline);
            border-radius: var(--border-radius-medium);
            font-family: inherit;
            font-size: 1rem;
            resize: vertical;
            min-height: 100px;
        }
        
        .qr-input:focus {
            outline: none;
            border-color: var(--md-sys-color-primary);
        }
        
        .qr-options {
            width: 100%;
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: space-between;
        }
        
        .qr-option {
            flex: 1;
            min-width: 150px;
        }
        
        .qr-option label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: var(--md-sys-color-on-surface-variant);
        }
        
        .qr-option select, .qr-option input {
            width: 100%;
            padding: 0.5rem;
            background-color: var(--md-sys-color-surface-container-high);
            color: var(--md-sys-color-on-surface);
            border: 1px solid var(--md-sys-color-outline);
            border-radius: var(--border-radius-small);
            font-family: inherit;
        }
        
        .qr-result {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem;
            background-color: var(--md-sys-color-surface-container-high);
            border-radius: var(--border-radius-large);
            width: 100%;
        }
        
        .qr-code-display {
            padding: 1rem;
            background-color: white;
            border-radius: var(--border-radius-medium);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .qr-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .qr-info {
            width: 100%;
            padding: 1rem;
            background-color: var(--md-sys-color-surface-container);
            border-radius: var(--border-radius-medium);
            text-align: center;
            font-size: 0.9rem;
            color: var(--md-sys-color-on-surface-variant);
        }
        
        .loading-spinner {
            display: none;
            width: 40px;
            height: 40px;
            border: 4px solid var(--md-sys-color-surface-container-high);
            border-top: 4px solid var(--md-sys-color-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <header class="page-header">
        <div class="nav-container">
            <div class="logo">
                <a href="/">ساخت QR کد</a>
            </div>
            <div class="nav-actions">
                <button class="btn btn-secondary" id="resetBtn">ریست</button>
            </div>
        </div>
    </header>

    <main class="page-container">
        <div class="post-card">
            <div class="post-content">
                <h1 style="text-align: center; margin-bottom: 1.5rem; color: var(--md-sys-color-primary);">سازنده QR کد سریع</h1>
                <p style="text-align: center; margin-bottom: 1.5rem;">متن خود را وارد کنید  تا QR کد آن تولید شود.</p>
            </div>

            <div class="qr-container">
                <div class="qr-input-container">
                    <textarea 
                        id="qrText" 
                        class="qr-input" 
                        placeholder="متن مورد نظر خود را اینجا وارد کنید..."
                        dir="auto"
                    ></textarea>
                    
                    <div class="qr-options">
                        <div class="qr-option">
                            <label for="qrSize">اندازه:</label>
                            <select id="qrSize">
                                <option value="200">کوچک (200x200)</option>
                                <option value="300" selected>متوسط (300x300)</option>
                                <option value="400">بزرگ (400x400)</option>
                                <option value="500">بسیار بزرگ (500x500)</option>
                            </select>
                        </div>
                        
                        <div class="qr-option">
                            <label for="qrColor">رنگ:</label>
                            <input type="color" id="qrColor" value="#000000">
                        </div>
                        
                        <div class="qr-option">
                            <label for="qrBgColor">رنگ پس‌زمینه:</label>
                            <input type="color" id="qrBgColor" value="#ffffff">
                        </div>
                    </div>
                    
                    <button id="generateBtn" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">تولید QR کد</button>
                </div>
                
                <div class="loading-spinner" id="loadingSpinner"></div>
                
                <div class="qr-result hidden" id="qrResult">
                    <div class="qr-code-display" id="qrCodeDisplay">
                    </div>
                    
                    <div class="qr-actions">
                        <button id="downloadBtn" class="btn btn-primary">دانلود QR کد</button>
                        <button id="shareBtn" class="btn btn-secondary">اشتراک‌گذاری</button>
                    </div>
                    
                    <div class="qr-info">
                        <p>QR کد شما با موفقیت تولید شد. می‌توانید آن را دانلود کنید یا با دیگران به اشتراک بگذارید.</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const qrText = document.getElementById('qrText');
            const generateBtn = document.getElementById('generateBtn');
            const resetBtn = document.getElementById('resetBtn');
            const qrResult = document.getElementById('qrResult');
            const qrCodeDisplay = document.getElementById('qrCodeDisplay');
            const downloadBtn = document.getElementById('downloadBtn');
            const shareBtn = document.getElementById('shareBtn');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const qrSize = document.getElementById('qrSize');
            const qrColor = document.getElementById('qrColor');
            const qrBgColor = document.getElementById('qrBgColor');
            
            let qrcode = null;
            
            const urlParams = new URLSearchParams(window.location.search);
            const textFromUrl = urlParams.get('text');
            
            if (textFromUrl) {
                qrText.value = decodeURIComponent(textFromUrl);
                generateQRCode();
            }
            
            generateBtn.addEventListener('click', generateQRCode);
            
            resetBtn.addEventListener('click', function() {
                qrText.value = '';
                qrResult.classList.add('hidden');
                qrCodeDisplay.innerHTML = '';
                qrcode = null;
                
                const url = new URL(window.location);
                url.searchParams.delete('text');
                window.history.replaceState({}, '', url);
            });
            
            downloadBtn.addEventListener('click', function() {
                if (!qrcode) return;
                
                const canvas = qrCodeDisplay.querySelector('canvas');
                if (canvas) {
                    const link = document.createElement('a');
                    link.download = 'qrcode.png';
                    link.href = canvas.toDataURL();
                    link.click();
                }
            });
            
            shareBtn.addEventListener('click', function() {
                if (navigator.share) {
                    const canvas = qrCodeDisplay.querySelector('canvas');
                    if (canvas) {
                        canvas.toBlob(function(blob) {
                            const file = new File([blob], 'qrcode.png', { type: 'image/png' });
                            navigator.share({
                                title: 'QR Code',
                                text: 'QR Code generated from: ' + qrText.value,
                                files: [file]
                            }).catch(err => console.log('Error sharing:', err));
                        });
                    }
                } else {
                    alert('مرورگر شما از قابلیت اشتراک‌گذاری پشتیبانی نمی‌کند. لطفاً از دانلود استفاده کنید.');
                }
            });
            
            function generateQRCode() {
                const text = qrText.value.trim();
                
                if (!text) {
                    alert('لطفاً متنی برای تولید QR کد وارد کنید.');
                    return;
                }
                
                loadingSpinner.style.display = 'block';
                qrResult.classList.add('hidden');
                
                qrCodeDisplay.innerHTML = '';
                
                const size = parseInt(qrSize.value);
                const color = qrColor.value;
                const bgColor = qrBgColor.value;
                
                setTimeout(() => {
                    try {
                        qrcode = new QRCode(qrCodeDisplay, {
                            text: text,
                            width: size,
                            height: size,
                            colorDark: color,
                            colorLight: bgColor,
                            correctLevel: QRCode.CorrectLevel.H
                        });
                        
                        const url = new URL(window.location);
                        url.searchParams.set('text', encodeURIComponent(text));
                        window.history.replaceState({}, '', url);
                        
                        loadingSpinner.style.display = 'none';
                        qrResult.classList.remove('hidden');
                    } catch (error) {
                        console.error('Error generating QR code:', error);
                        loadingSpinner.style.display = 'none';
                        alert('خطا در تولید QR کد. لطفاً دوباره تلاش کنید.');
                    }
                }, 300);
            }
        });
    </script>
</body>
</html>